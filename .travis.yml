language: go
sudo: false
go:
- 1.5
before_install:
- npm install
- pip install --user ruamel.yaml
script:
- "./codecheck.sh -u"
- npm test
- go test ./...
- cd acceptance && go test -tags acceptance && cd ..
branches:
  only:
  - master
  - production
before_deploy:
- export BUILD_INFO=build-$TRAVIS_BRANCH-$(date -u "+%Y-%m-%d-%H-%M-%S")-$TRAVIS_BUILD_NUMBER
# Extract any encrypted env vars and put them into the manifests/manifest-master.yml
- python deploy/travis-vars-to-manifest.py
# Download the go-bindata binary, which is necessary for the CF CLI
- go get -u github.com/jteeuwen/go-bindata/...
- export GOBINDATA_BIN=$(which go-bindata)
- export PATH=$GOBINDATA_BIN:$PATH
- echo $GOBINDATA_BIN
# Download the autopilot binary
- go get -u github.com/concourse/autopilot
- export GOAUTOPILOT_BIN=$(which autopilot)
- export PATH=$GOAUTOPILOT_BIN:$PATH
# Make sure we can execute the deploy script.
- chmod a+x deploy/travis_deploy.sh
# Download the CF CLI Soruce files
- export CLIPATH=$HOME/gopath/src/github.com/cloudfoundry/cli
- export GOPATH=$HOME/gopath/$CLIPATH/Godeps/_workspace:$HOME/gopath
- mkdir -p $CLIPATH
- git clone --branch v6.12.3 https://github.com/cloudfoundry/cli.git $CLIPATH
# Build the CF CLI
- chmod a+x deploy/prepare_deploy.sh
- deploy/prepare_deploy.sh
deploy:
- provider: script
  skip_cleanup: true
  script: deploy/travis_deploy.sh
  on:
    branch:
    - master
    - production
env:
  global:
  - CF_API=https://api.18f.gov
  - CF_ORGANIZATION=cf-deck
  - CONSOLE_UAA_URL=https://uaa.18f.gov/
  - CONSOLE_API_URL=https://api.18f.gov/
  - CONSOLE_LOG_URL=https://loggregator.18f.gov/
  - CONSOLE_LOGIN_URL=https://login.18f.gov/
  - CONSOLE_HOSTNAME=http://localhost:9999/
  - secure: xn/EXShpj51D9TTQgwrOj5H3c7gr41i+KnoOesfJDc1twY4reS8bWIBZU1zq2xaMsA8sus97Byk5MSXKifIzO5Gk6nyKzBo1z0HIXhpAVBy8RwNpLvUZrjrtz/24FmeQWs7McIfPZ92UWsGTI0BGVsSbIeAzeAkwIXb0/M1HUG4r7wgEOF+dlr3pYOtQBJ45wsst+n1RzUbWyHP7UPCcNHSrI7Q1y4odtK0MLMIozWBm5TbhpJnN4ylQCVPg2077Bsb5emg0G1K2Gfplhzvsu2+1BOekBHBsA4MJIPA1Y4dB2rkHeRvWgIyjg+w+wDyq0Kd4yP5Kku/N1U2b1llaOOLNABGYmfkteFgugHv73xfPoN2uLRIrWOpxywp+r/7qVDO8s5ZjjAGQfnFql53JBxD7/eAKH4sqaR5uW1uSpwpAmjaNAa7wcmgFKi0nyFovIBgbTH37M8nSDIS6/YfYYRiGMQA3piiUvBqVFpguSDrgup8/O8KsMn2SfPLvk7GG5bb8JOO0dWzXFuq1CWSzU4cIvcYfVkwmOKjpvKXYX1ebZz3T7i+ZL1fijQKFMlzpQGNPqHZJ/QwjH45G+Nw8Cz4waxP8l4C4ros5rIgR6CdYoRqfrhGMODum/JmoChM85hVbZbRw0AMJ+mRgprqDkru1AGSeBrxxSnwmX6eS0bs=
  - secure: GJ6iBRZ0NAw9d/RxA0BjyIRawDYUd5oVPRSEvmRWzxjw+eghBCKgp/K3RW7D6hbKUJTJ/A95Tm1cy74OgUffMkD5q5I6AJaf0LHp5rNSVP5Izu0ewbh95UE6WbFhytJjLu0Qsl0uW9v5/omG4Qm7odvvnWGO8yGDJpAbO+rMG1I09puy8n5QNESuUX0pwJKsQ1E/3uHwPfhFUacKl0bFHIEM8hLA9FWV5pl5p+cbx3fAU4U6hajB9Pur9zlRWb88nFOjrDE86RpA6Ihcu6qWERmOz441NWinUfGoLZruWp4YVhErZVp2KcOpMWyl5ObQ8Bu8JWyT9tGInyI9KPO+b5UI7i1jUkRJyQT2/snRdWcvYMWPe7gyQMz8VIogR/UUGOCBUGFm2+N03cb+UV8NxfSuR7IruX+8fWw0HvL02QYGWB1pTbebpdwn+V/ZO0+6DrOn62BVpxVqE8mNVS9Z2927GDsXRBA/C/KAHK6zaa1Vk5ADCDCFe3meysBp6BIWXKRDlnXgsomQzjAZ+Ri5us5zPWYQnIjvbJGUwXOpcFn7HiAQf0JzhvTb6s1F64Lr9yk82+rqtMSf5H3WW6yaJUirGtxlb1McD4BnsIH7F/C0ALJdZy35ZCKFhvFbGdsBeZGl6AYIuNqKz3r5U6gYycrRQ+/lGftVVRUTk90gR8A=
  - secure: JqzE4ugmAPeR+ilxRTn1ww0Df130YmBZKwPmAtsVTVztZpwZR4rzw2Gw6bMiPJ+fRnH/jYxTqic1tKWKIqmgqeZXrjmN2ChiSSi87rouZ1kk9PINwr4PAu1eO+fGL5l+23zDNPx8kYM8QZkJTVhSbt+jG/z3Wx1qqmSHLey9lEngoLGLiDAfQV18LDpC/QWNOnIaUgIcjvEmoZbvqWVmlKETSmccx/ojKrESaTKu2qRxu0PtF94lMB/v/O5kI8DY6OjuQjy6KK6X7dk8aoZ9OHSu0IM1V9EkWdh77PQwxTuGUuUBQmC6h2Xol9BhTZmDICZhGa7A0E6tQ+oMcnwnWEFAU1B1ZeXhw3dS7HmAHWJW6rNr3CtwzkxfWnGLbunEouV27Idf6JLgtnOtpvyzoBRJkU3Ous83nU3f5RtZvHzz0w8pmR9dOC6J3U4x9nmy1JRn6uubCurxXMkL6pg3Uo2CERe4elvK5bL+lb9ZyXosFn2GcjHQq9zohKp7vs5u0+N1jiq7f10mkVZ2NaqD15D2r+Yz9l5DnWjYowIG5Ba3T6bHIHLx7jOWqQTCYmNaqh6YSud4zqaaTy9czC68An1ruXsV3D/cRRoxDqMEGr4R9wQqJG4jDre0Yd2YvYrj776c/8thvWk3uBmZL3+Y91/YXf0cnCoDsrgmRUwaG9s=
  - secure: oqoQSr6gbt/CRMg43Sw+Gfrf2J+fgIXSyAC5il1KwqcsLMbE/ELq+3L2V+3jKF4s/YzIRcEIljv6x8ZxZxKPBk9rmQRAh7cYSrSm1Fqr4R5TgGtHuFQ7tZQbtFBAi/BmYcFn+AxacM7AX1aSoUcMfqZiYN7g5obS1D7RQrHBq20GVDQjbrsh7VuLI+MjKaIQ75oakChzjbkkp9G1nMo8dnKqQBPK3qI99yp/YN7TzEfTS8lYYa/gHIm1vvKjwD1OL3MhNc380B1j59JCRLdw/Um+fQEa+k/65lA8SEBvBAYa1UOmi+ocrJJ4FOxmS5x+IAA6kF0LsWZe3KDqLS/SDJJ9Vgs54gjbF/hL1sGnQVOGEdO1YiDSkWd5BvQOX0vKVm9TUwNKeVd7D2fxPRa3rR11M6UnIMF3mCzsZau9C6+2sg6gFHCtpr8ejnXSa0PLFomZJ0m5Cwlf3SKtO4Zck3ZeKSoeDv0Kt8kvCzkvgUVRQwF4Z36PMpIHNXZTjqxje2mdyf9oq+rtfM6MSlOK7pJBXc5pc0yWXgv6ccalizW581Ehm4gzhDhA7WxEY8xefeF83PNnpFp/s2l/++Gef5+0HaP7tnAAZw9Yl+qQl0LCca0IdkCZwgtj0ISk0q/wHB91GsuiYmM1h2rs5xdj1Vk/C1nTGJuxIvJYDiy3dRk=
  - secure: uvGaSKmxNLQfXt5v1+1dcamIyPS4RcmaGV/gQIQwMO5Abh4/I4Tt77yQbfsujbEv9ScvJIvoGzpWNZN8BcbvC5c0H+gLzgb/06lDLxp4V9N1Oz3c3xFgWkGm/snlwu83GOmCzAPyrjRWHUDfXwZ7Q6ZXgnwRojN4Agt+IVvF65ISxh9y071k62IKBTX3o4PbP0MFxldDlcy9biZy1rn+CyPFOGDnAbv/cLwporsF8KLM3cCUrqRA7cFl6MDYZgsSDw9MmIrbgd7LL5TCotKPFvlwSzTciwyWFrUwtfWyoVnVmwgihxD5mDu2weR8cjRHceWQWM4JMYoPB7gyAwXGLk1V/D6n5+bquYoWZ+cqLANCfpHqXmgTnliWmX10UnvUHoJIBBmaYR3NqD5hJa4cHhXbo0GAS4/6auXuUpE3QIWDe+nMDp/0t/1ClxWghXLWtB+kXDvBTOFvVps2YsV6TCYh0KeiqeFeZN9BLtiWhm9kfrgcaflj9StUyhJM2T2YTDsFgJII63RDia3llwUHrKoizGjGAajgLx/ZAulJEI3KjktRedzWlgQvLOqk83CLrNd+w96rF9bBdtNbo8bEvygEhWhkbWO4MBnUQj6OFtUuJh/fBwx/IKfWAt49XxV1SOEFbpOyMA79ULM4KtNC6ORFD8Z/t7Uu44Fkq8GMBTU=
  - secure: DaTbJHmb1eA4gPMQOKioCGrmwtQp31a9piJs8acCi4thuj9z6R+kJKMbI4bAouanYJweRM7urWgYRrKKk3c2eqFNI5SfV9ckkYpoXZJ/BXn23iEt/LL3DA3A6vSJj/92u/wPWqoL3cmeFCXUujUHFsk4P6ZQ3VGijJEo63toY8BTY/ZL+8dcYwBiaI51y2eeTl4uL4+zrN/ckIlt7yPPSnl38ZK4R18uRu551OtRQlh1ku4XH34CEbE/4nM4vKozs4XasVi3rMqFDwIg2cHcFqCmpRiCknvvrIOhMtyxDoauRsbLf+MPqEbWdsW0B56X1G5wXKdf2IkG6J7fF+jAAWEurajYJWqucswd+yETE+h6IlsxZcs5FO0py7SToi8qbIMxtBerv4te9/psw/qCCRVkTYRo4VlDiI3Cv0xE++hUxN9aunUl5uChpmNgM/HLnTpyxy6F62R8g+hG93KRxJXlk+LIDNOwSamfjyvIpdcBF7XdDEy6dddw+CGh1VX0x+HRwKq3VhbGeA/EgSpqjDqv8ALtQC5GoMLrSEV+KznlC7yUSCU1tAxp5duNIVcaKjGaOD0qeHoE5w17tWugtUeS/yAha1o90I/ZnxPr5AWTYtSmIDHALudsWn1gTr8QmS+6Po6aEy8kPrP/bJgZWMsmooboIBH7476a5iYzTSs=
